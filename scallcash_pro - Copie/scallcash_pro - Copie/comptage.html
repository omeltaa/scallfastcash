<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SCALLCASH - Comptage 24h</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-page="comptage">
  <nav class="navbar">
    <a href="index.html" class="logo">
      <span class="icon">€</span>
      SCALLCASH
    </a>
    <div class="nav-links">
      <a href="index.html">Dashboard</a>
      <a href="comptage.html" class="active">Comptage 24h</a>
      <a href="ventes.html">Ventes &amp; Encaissements</a>
      <a href="achats.html">Achats &amp; Dépenses</a>
      <a href="facturation.html">Facturation</a>
      <a href="rapprochement.html">Rapprochement</a>
      <a href="tva.html">TVA &amp; Exports</a>
    </div>
  </nav>
  <main class="page-wrap">
  <div class="tabs">
    <button class="tab active" data-tab="comptage">Comptage</button>
    <button class="tab" data-tab="historique">Historique</button>
  </div>

  <!-- COMPTAGE -->
  <section id="tab-comptage" class="grid-2">
    <section class="card">
      <h3>Comptage</h3>

      <div class="row gap">
        <label for="caisseDate"><strong>Date :</strong></label>
        <input type="date" id="caisseDate" />
        <button id="btnToday" class="btn secondary">Aujourd'hui</button>
        <label for="siteSelect"><strong>Site :</strong></label>
        <select id="siteSelect">
          <option value="vitry">Vitry</option>
          <option value="raincy">Raincy</option>
        </select>
      </div>

      <div class="expenses-table-container">
        <table class="expenses-table" id="countTable">
          <thead>
            <tr>
              <th>Billet/Pièce</th>
              <th style="width:160px;">Quantité</th>
              <th class="right">Total</th>
              <th style="width:80px;"></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
          <tfoot>
            <tr>
              <td colspan="4">
                <div style="height:1px;background:#e6eaf2;margin:.25rem 0 .5rem;"></div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td class="right"><strong>Sous-total</strong></td>
              <td class="right"><strong id="subtotal">0,00 €</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="cards-3">
        <div class="card">
          <h3>Total compté</h3>
          <div class="value" id="sumCounted">0,00 €</div>
        </div>
        <div class="card">
          <h3>Comptage VLP (€) :</h3>
          <input type="number" id="vlp" step="0.01" placeholder="0" class="input" />
        </div>
        <div class="card">
          <h3>Différence (compté - VLP)</h3>
          <div class="value" id="diffVal">0,00 €</div>
        </div>
      </div>

      <div class="row gap">
        <button id="addLine" class="btn">+ Ajouter une ligne</button>
        <button id="save" class="btn success">Enregistrer</button>
        <button id="clear" class="btn danger">Vider</button>
        <button id="print" class="btn secondary">Imprimer</button>
      </div>
    </section>

    <aside class="card">
      <h3>Raccourcis billets/pièces</h3>
      <p class="muted">Clique pour ajouter une ligne avec la valeur choisie.</p>
      <div id="chips" class="chips"></div>

      <h3>Sauvegarde</h3>
      <div class="row gap wrap">
        <button id="backup" class="btn secondary">Exporter (.json)</button>
        <input id="restoreFile" type="file" accept=".json" />
        <button id="restore" class="btn secondary">Restaurer</button>
      </div>
    </aside>
  </section>

  <!-- HISTORIQUE -->
  <section id="tab-historique" class="card" style="display:none;">
    <h3>Historique des comptages</h3>
    <div class="row gap">
      <label for="searchDate"><strong>Recherche par date :</strong></label>
      <input type="date" id="searchDate" />
      <button id="btnSearch" class="btn">Rechercher</button>
      <button id="btnReset" class="btn secondary">Réinitialiser</button>
      <span class="muted">Astuce : sans filtre = tous les enregistrements.</span>
    </div>

    <div class="expenses-table-container">
      <table class="expenses-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Site</th>
            <th class="right">Compté</th>
            <th class="right">VLP</th>
            <th class="right">Différence</th>
            <th style="width:180px;">Actions</th>
          </tr>
        </thead>
        <tbody id="histBody">
          <tr><td colspan="5" class="muted">Aucun comptage.</td></tr>
        </tbody>
      </table>
    </div>
  </section>
</main>

<style>
  .page-wrap{padding:1rem 1.5rem}
  .grid-2{display:grid;grid-template-columns:2fr 1fr;gap:1rem}
  @media (max-width: 1024px){.grid-2{grid-template-columns:1fr}}
  .cards-3{display:grid;grid-template-columns:repeat(3,minmax(220px,1fr));gap:1rem;margin:1rem 0}
  @media (max-width: 900px){.cards-3{grid-template-columns:1fr}}
  .row{display:flex;align-items:center}
  .gap{gap:.5rem}
  .wrap{flex-wrap:wrap}
  .right{text-align:right}
  .tabs{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.5rem}
  .tab{border:1px solid #e6eaf2;background:#fff;border-radius:999px;padding:.4rem .9rem;cursor:pointer;font-weight:600}
  .tab.active{background:var(--color-primary,#0b2f5b);color:#fff;border-color:var(--color-primary,#0b2f5b)}
  .chips{display:flex;flex-wrap:wrap;gap:.5rem}
  .chips .chip{border:1px dashed #e6eaf2;background:#fff;padding:.35rem .7rem;border-radius:999px;cursor:pointer}
  .input{width:100%;padding:.6rem;border:1px solid #e6eaf2;border-radius:8px}
  .btn.success{background:#16a34a;color:#fff}
  .btn.danger{background:#dc2626;color:#fff}
</style>
  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="kpi-core.js"></script>
</body>
</html>